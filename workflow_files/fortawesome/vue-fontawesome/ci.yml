name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        free-solid-svg-icons: [7.x, 6.x, 5.x]
        fontawesome-svg-core: [7.x, 6.x, 1.2.x]
        node-version: [20.x, 18.x]
        vue: [3.0.x, 3.1.x, 3.2.x, 3.3.x, 3.4.x, 3.5.x]
        exclude:
          # Only exclude v7.x icons with v6.x and v1.2.x core
          - free-solid-svg-icons: '7.x'
            fontawesome-svg-core: '6.x'
          - free-solid-svg-icons: '7.x'
            fontawesome-svg-core: '1.2.x'

    steps:
      - uses: actions/checkout@v1

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v1
        with:
          node-version: ${{ matrix.node-version }}

      - name: Setup npm
        run: |
          npm install -g npm@10
          npm --version

      - name: install, build, and test
        run: |
          npm install
          npm install --no-save @fortawesome/fontawesome-svg-core@${{ matrix.fontawesome-svg-core }} @fortawesome/free-solid-svg-icons@${{ matrix.free-solid-svg-icons }}
          npm install --no-save vue@${{ matrix.vue }}
          VER=$(npm list vue | grep vue@ | cut -d@ -f3)
          if [ "$(printf '%s\n' "3.2.12" "$VER" | sort -V | head -n1)" = "$VER" ]; then
            npm install --no-save @vue/server-renderer@${{ matrix.vue }}
          fi
          npm run build
          npm run test

      - name: dist
        run: |
          npm install
          npm run dist
        env:
          CI: true
