name: Check DVC GitHub Action
on:
  schedule:
    - cron: '0 0 * * *' # everyday @ 0000 UTC
  pull_request:
jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - run: |
          npm ci
          npm run build
          git diff --exit-code
  check:
    defaults:
      run:
        shell: bash
    strategy:
      matrix:
        installer: [pip]
        system:
          - ubuntu-latest
          - macos-latest
          - windows-latest
          - windows-11-arm
          - macos-13
        version:
          - '1.0.1'
          - '2.18.1'
          - '3.60.1'
        include:
        - system: ubuntu-22.04-arm
          version: '3.61.0'
          installer: uv
        - system: ubuntu-22.04-arm
          version: '3.61.0'
          installer: pip
    runs-on: ${{ matrix.system }}
    steps:
      - uses: actions/checkout@v5
      - uses: astral-sh/setup-uv@v6
        if: matrix.installer == 'uv'
      - run: npm ci
      - run: npm run lint
      - run: npm run test
      - name: local action with ${{ matrix.version }}
        uses: ./
        with:
          version: ${{ matrix.version }}
      - run: dvc version || true
      - name: test DVC specific version
        run: |
          test "$(dvc --version)" == "${{ matrix.version}}"
      - name: local action with defaults
        uses: ./
      - run: dvc version || true
      - name: test DVC latest version
        run: |
          test "$(dvc --version)" != "${{ matrix.version}}"
