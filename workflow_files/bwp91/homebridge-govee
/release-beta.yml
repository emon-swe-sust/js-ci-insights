name: Release (Beta)

# To publish a new plugin version (to the npm 'beta' tag):
# 1. Do not modify any versions in the package.json and package-lock.json
# 2. Instead, create a branch with the name beta-X.Y.Z (e.g. beta-1.0.1, where 1.0.1 is the new version)
# 3. Each commit to the branch will trigger this workflow, which will publish the beta version to npm
#    -> the first commit will publish as v1.0.1-beta.0, the second commit will publish as v1.0.1-beta.1, etc.

on:
  push:
    branches: [beta-*.*.*]

permissions:
  contents: read

jobs:
  eslint:
    uses: homebridge/.github/.github/workflows/eslint.yml@latest

  publish:
    if: ${{ github.repository == 'homebridge-plugins/homebridge-govee' }}
    needs: eslint
    permissions:
      id-token: write
    uses: homebridge/.github/.github/workflows/npm-publish-esm.yml@latest
    with:
      tag: beta
      dynamically_adjust_version: true
      npm_version_command: pre
      pre_id: beta
    secrets:
      npm_auth_token: ${{ secrets.npm_token }}
