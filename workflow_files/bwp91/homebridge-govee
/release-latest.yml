name: Release (Latest)

# To publish a new plugin version (to the npm 'latest' tag):
# 1. Update the version in package.json and package-lock.json and commit to the 'latest' branch
# 2. Create a new release on GitHub with the tag vX.Y.Z which points to the 'latest' branch
# 3. The release will trigger this workflow, which will publish the new version to npm

on:
  release:
    types: [published]

permissions:
  contents: read

jobs:
  eslint:
    uses: homebridge/.github/.github/workflows/eslint.yml@latest

  publish:
    if: ${{ github.repository == 'homebridge-plugins/homebridge-govee' }}
    needs: eslint
    permissions:
      id-token: write
    uses: homebridge/.github/.github/workflows/npm-publish-esm.yml@latest
    secrets:
      npm_auth_token: ${{ secrets.npm_token }}
