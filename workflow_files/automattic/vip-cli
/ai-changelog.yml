name: Generate Changelog and Validate Docs for PR

on:
  issue_comment:
    types:
      - created

permissions:
  contents: read

jobs:
  changelog:
    name: Generate Changelog for PR
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    if: >
      github.event.issue.pull_request &&
      github.event.comment.body == '/changelog'
    steps:
      - name: Generate changelog for PR
        uses: Automattic/vip-actions/ai-changelog-generator@a10bde8914496b7386d10fc5df9b4ffa2fd72ef1
        with:
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}
  docs-doctor:
    name: Analyze docs.wpvip.com for inconsistencies
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    if: >
      github.event.issue.pull_request &&
      github.event.comment.body == '/docs-doctor'
    steps:
      - name: Generate Report
        uses: Automattic/vip-actions/docs-doctor@trunk
        with:
          url: https://docs.wpvip.com
          sitemap_url: https://docs.wpvip.com/page-sitemap.xml
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}
